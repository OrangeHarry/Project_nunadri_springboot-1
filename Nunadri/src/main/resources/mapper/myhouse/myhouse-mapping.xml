<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.springproject.mapper.MyhouseMapper">


	<insert id="insertMyhouseBoard">
		INSERT INTO NOTICE_MYHOUSE
		(
		MYHOUSE_NO
		, MYHOUSE_CATEGORY
		, NICKNAME
		,HOUSE_NO
		, MYHOUSE_TITLE
		, MYHOUSE_CONTENT
		, MYHOUSE_REGDATE

		) values (
		(SELECT
		IFNULL(MAX(MYHOUSE_NO), 0) + 1
		FROM
		NOTICE_MYHOUSE ALIAS_FOR_SUBQUERY
		WHERE
		MYHOUSE_CATEGORY = #{myhouseCategory})
		, #{myhouseCategory}
		, #{nickname}
		, (SELECT HOUSE_NO FROM house where address = (SELECT address
		from member where nickname = #{nickname}))
		, #{myhouseTitle}
		, #{myhouseContent}
		, NOW()
		)
	</insert>

	<select id="getMyhouseBoardList" resultType="com.springproject.vo.NoticeMyhouseVO"> 
		<!-- SELECT * FROM NOTICE_MYHOUSE WHERE MYHOUSE_CATEGORY = #{myhouseCategory} -->
		SELECT MYHOUSE_NO,  MYHOUSE_CATEGORY, NICKNAME, MYHOUSE_TITLE, MYHOUSE_CONTENT, MYHOUSE_REGDATE
        FROM NOTICE_MYHOUSE 
        WHERE MYHOUSE_CATEGORY = #{myhouseCategory}
		<if test="searchCondition == 'MYHOUSE_TITLE'"> 
            AND MYHOUSE_TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
          </if> 
         <if test="searchCondition == 'MYHOUSE_CONTENT'">
            AND MYHOUSE_CONTENT LIKE CONCAT('%', #{searchKeyword}, '%')
         </if> 
         <if test="searchCondition == 'NICKNAME'">
            AND NICKNAME LIKE CONCAT('%', #{searchKeyword}, '%')
         </if>
         <if test="searchCondition == 'MYHOUSE_TITLE_MYHOUSE_CONTENT'">
            AND MYHOUSE_TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
            OR MYHOUSE_CONTENT LIKE CONCAT('%', #{searchKeyword}, '%')
         </if>
           
        ORDER BY MYHOUSE_NO DESC
		
		</select>

	
	<select id="getMyhouseBoard" resultType="com.springproject.vo.NoticeMyhouseVO">
		SELECT * FROM NOTICE_MYHOUSE WHERE MYHOUSE_NO = #{myhouseNo} AND MYHOUSE_CATEGORY =#{myhouseCategory}
	</select>
	
	   <delete id="deleteBoardSeq">
        DELETE FROM Notice_Myhouse
        WHERE myhouse_no = #{myhouseNo}
        AND MYHOUSE_CATEGORY = #{myhouseCategory}
     </delete>
	

</mapper>
